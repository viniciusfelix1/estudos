# 201

Neste arquivo contém anotações feitas durantes estudos para a prova 201 da LPI.

---

## Links de apoio
https://github.com/jhajek/linux-text-book-part-1﻿
https://www.lisenet.com/lpic-2/﻿
http://lpic2.unix.nl/lpic2.pdf

---

## Tópicos da prova e pesos
Topic 200:Capacity Planning - Weight 8
Topic 201: Linux Kernel - Weight 9
Topic 202: System Startup - Weight 9
Topic 203: System Startup: Filesystem and Devices - Weight 9
Topic 204: Advanced Storage Device Administration - Weight 8
Topic 205: Network Configuration - Weight 11
Topic 206: System Maintenance - Weight 6

---

## Anotações

### Topic 200:Capacity Planning - Weight 8
#### 200.1 Measure and Troubleshoot Resource Usage - Weight: 6
#### 200.2 Predict Future Resource Needs - Weight: 2

### Topic 201: Linux Kernel - Weight 9
#### 201.1 Kernel Components - Weight: 2
O kernel é o núcleo do Linux

Existe o kernel monolitico, é um kernel que tudo é implementado em um único processo e o microkernel, neste o kernel é só um controlador principal e há servers que gerenciam os recursos.

O kernel é monolitco, mas modular.
https://www.kernel.org/
As fontes vindas do site acima, são compactadas em XZ.

A versão do kernel é dividia da seguinte forma:
5.4.1 -> Versão.Release.Patches


##### Diretórios
A fonte do kernel está em /usr/src, mas no geral não é necessário ter baixado no servidor, então podem ser removidos para salvar espaço em disco. Por boas práticas, é interessante criar um link simbólico chamado 'linux' dentro deste diretório que aponta para a versão que está sendo utilizada.
Dentro do diretório /usr/src/linux/Documentation está a documentação do kernel
Dentro do direório /boot/ está o kernel compilado e tem a nomenclatura de 'vmlinuz'. Uma imagem pode ser de dois tipos, ou zImage, cabia apenas 512 bytes e era carregada na low memory ou então bzImage esta imagem não tem limite de tamanho. Ambos são comprimidos usando o algoritimo gzip
Dentro do diretório /lib/modules ficam os arquivos referentes aos módulos, estes arquivos tem a finalização com '.ko'
201.2 Compiling a kernel - Weight: 3

O comando 'make' é o principal comando para a compilação de programas, mas para funcionar, é necessário a instalação do pacote no Debian "build-essential".

É possível realizar a configuração do kernel de algumas formas, a primeira é a seguinte:
Dentro do diretório /usr/src/linux, rodar o comando "make config", porém com este comando, será feitas várias perguntas.
A segunda forma, seria:
Ainda dentro do diretório /usr/src/linux, rodar o comando "make menuconfig", mas para funcionar é necessário o pacote "ncurses-dev" instalado.  A configuração é baseado no arquivo .config.
O menu é um dialog. Nas funcionalidades, é possível se o módulo vai ser carregado como módulo (M) ou então se ele ficará dentro do kernel (built-in) (*)

Após configurar, podemos compilar de fato nosso kernel, para isso, rodamos o comando "make -j2 bzImage", com o parametro "-j2" a compilação irá abrir dois processos. O comando "make -j2 modules" irá compilar os módulos.

Depois de ter realizado as compilações, podemos rodar o comando "make clean" irá limpar todos arquivos compilados. O comando "make mrproper" irá limpar tudo também e até o .config.

O comando "make install modules" irá colocar os módulos no lugar correto, ou seja, vai fazer a instalação dos módulos. Os módulos estão carregados no diretorio /usr/modules.

Após ter tudo compilado, pode se rodar o comando "make install" irá instalar o novo arquivo do kernel.

Com o comando "mkinitramfs -o /boot/NOME-DO- ARQUIVO VERSÃO" será gerado os arquivos para inicialização.

1º -> Baixar img do kernel e descompactar em /usrc/src
2º -> "make menuconfig" para configurar oq será utilizado
3º -> "make bzImage" gera a nova imagem do kernel
3º -> "make modules" compila os módulos
4º -> "make modules install" instalar os modulos em /usr/lib/modules
5º -> "make install" copia a imagem, gera os arquivos em /boot e atualiza o grub

"make deb-pkg" irá criar um pacote com a imagem do kernel para ser passado via pacote .deb e o pacote é gerado em /usr/src. "make rpm-pkg" gera a imagem compilada.

O dkms é um framework para resolver um problema q a intel tinha que as atualizações de kernel quebravam os módulos criados por eles. O framework faz com que os módulos que estão sendo gerenciados por ele, sejam atualizados automaticamente junto com o kernel.
201.3 Kernel runtime management and troubleshooting - Weight: 4
uname -a mostra várias infos do servidor

O diretório /proc/sys/kernel mostra informações do kernel em tempo real. Com o comando sysctl conseguimos ver as infos desse diretorio e também alterar alguma propriedade, ex:
sysctl fs.file-max # Irá exibir a configuração.
sysctl -w fs.file-max=100000 # irá atualizar o valor
A alteração não é permanente, ao reiniciar o arquivo será populado com o valor padrão.
Para deixar permanente, é necessário alterar no arquivo /etc/sysctl.conf

Com o comando "udevadm monitor" é possível monitorar em tempo real as ações de hotplug e cold plug. No arquivo /etc/udev/udev.conf estão as configurações. Arquivos de regra estão em /etc/udev/rules.d, mas o padrão do sistema é em /lib/udev/rules.d

---

### Topic 202: System Startup - Weight 9
#### 202.1 Customizing SysV-init system startup - Weight: 3
#### 202.2 System Recovery - Weight: 4
#### 202.3 Alternate Bootloaders - Weight: 2

---
### Topic 203: System Startup: Filesystem and Devices - Weight 9

####  203.1 Operating the Linux filesystem - Weight: 4

**mount, cat /etc/mounts e /etc/mtab**:  mostram as partições que estão montadas nesse momento

"blkid ou lsblk -f" irá mostrar o UUID do disco.

findfs UUID=X, irá mostrar a partição que tem X UUID

findfs LABEL=Y, irá mostrar a partição que tem Y LABEL


#### 203.2 Maintaining a Linux filesystem​ - Weight: 3

#### 203.3 Creating and configuring filesystem options - Weight: 2
---
### Topic 204: Advanced Storage Device Administration - Weight 8
#### 204.1 Configuring RAID - Weight: 3

Os principais tipos de RAID são:
* RAID 0 Stripping, é combinar dois discos;
* RAID 1 Mirroring, espelhamento de discos;
* RAID 5 Necessários no minimo 3 discos, pois será feito um 'XOR' dos bits.

Enquanto se formata a partição, é interessante formatar o disco como Linux raid autodetect, para isso, dentro do fdisk, aperta "t" e seleciona o tipo "fd", esse tipo também é conhecido como 0xFD.

O comando "mdadm -v --create /dev/md0 -l0 -n2 /dev/sdc1 /dev/sdd1" irá criar um dispositivo dentro de '/dev/md0' usando raid 0 (-l0) com dois dispositivos.

cat /proc/mdstat -> irá mostrar informações sobre os raids ativos.
mdadm --detail /dev/md0 -> irá mostrar detalhes sobre o raid
cat /etc/mdadm/mdadm.conf -> Possui infos sobre os raids criados que o sistema utiliza para montar automaticamente, para popular é necessário utilizar o comando abaixo:
mdadm -v --detail --scan >> /etc/mdadm/mdadm.conf

mdadm --manage --fail /dev/md1 /dev/sdd2 # Irá simular uma falha no disco do raid
mdadm /dev/md1 [-r|-a] /dev/sdd2 # remove ou adiciona o disco do raid

mdadm --stop /dev/md0 # Irá parar um disco do raid
mdadm --assemble --run /dev/md0 # Irá iniciar o raid novamente

**Processo para remover definitivamente o raid:**
```bash
mdadm --stop /dev/md0 # Stopa o raid
mdadm --remove /dev/md0 # Remove o raid
mdadm --zero-superblock /dev/sdc1 # Zera o superblock dos discos, pois neles há informações sobre os raids montados que são montados automaticamente
Limpar as entradas do arquivo /etc/mdadm/mdadm.conf
```

#### 204.2 Adjusting Storage Device Access - Weight: 2
#### 204.3 Logical Volume Manager - Weight: 3

### Topic 205: Network Configuration - Weight 11
#### 205.1 Basic networking configuration - Weight: 3
#### 205.2 Advanced Network Configuration and Troubleshooting - Weight: 4
#### 205.3 Troubleshooting Network Issues - Weight: 4

### Topic 206: System Maintenance - Weight 6
#### 206.1 Make and install programs from source - Weight: 2
#### 206.2 Backup operations - Weight: 3
#### 206.3 Notify users on system-related issues - Weight: 1
